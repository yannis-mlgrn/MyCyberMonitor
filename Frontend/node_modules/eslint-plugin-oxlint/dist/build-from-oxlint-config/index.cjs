"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
const fs = require("node:fs");
const JSONCParser = require("jsonc-parser");
const utilities = require("./utilities.cjs");
const rules = require("./rules.cjs");
const categories = require("./categories.cjs");
const plugins = require("./plugins.cjs");
const ignorePatterns = require("./ignore-patterns.cjs");
const overrides = require("./overrides.cjs");
const configHelper = require("../config-helper.cjs");
const defaultPlugins = ["react", "unicorn", "typescript"];
const defaultCategories = { correctness: "warn" };
const getConfigContent = (oxlintConfigFile) => {
  try {
    const content = fs.readFileSync(oxlintConfigFile, "utf8");
    try {
      const configContent = JSONCParser.parse(content);
      if (!utilities.isObject(configContent)) {
        throw new TypeError("not an valid config file");
      }
      return configContent;
    } catch {
      console.error(
        `eslint-plugin-oxlint: could not parse oxlint config file: ${oxlintConfigFile}`
      );
      return void 0;
    }
  } catch {
    console.error(
      `eslint-plugin-oxlint: could not find oxlint config file: ${oxlintConfigFile}`
    );
    return void 0;
  }
};
const buildFromOxlintConfig = (config) => {
  const rules$1 = {};
  const plugins$1 = plugins.readPluginsFromConfig(config) ?? defaultPlugins;
  const categories$1 = categories.readCategoriesFromConfig(config) ?? defaultCategories;
  plugins$1.push("eslint");
  if (plugins$1.includes("react")) {
    plugins$1.push("react-hooks");
  }
  categories.handleCategoriesScope(plugins$1, categories$1, rules$1);
  const configRules = rules.readRulesFromConfig(config);
  if (configRules !== void 0) {
    rules.handleRulesScope(configRules, rules$1);
  }
  const baseConfig = {
    name: "oxlint/from-oxlint-config",
    rules: rules$1
  };
  const ignorePatterns$1 = ignorePatterns.readIgnorePatternsFromConfig(config);
  if (ignorePatterns$1 !== void 0) {
    ignorePatterns.handleIgnorePatternsScope(ignorePatterns$1, baseConfig);
  }
  const overrides$1 = overrides.readOverridesFromConfig(config);
  const configs = configHelper.splitDisabledRulesForVueAndSvelteFiles(
    baseConfig
  );
  if (overrides$1 !== void 0) {
    overrides.handleOverridesScope(overrides$1, configs, categories$1);
  }
  return configs;
};
const buildFromOxlintConfigFile = (oxlintConfigFile) => {
  const config = getConfigContent(oxlintConfigFile);
  if (config === void 0) {
    return [];
  }
  return buildFromOxlintConfig(config);
};
exports.buildFromOxlintConfig = buildFromOxlintConfig;
exports.buildFromOxlintConfigFile = buildFromOxlintConfigFile;
